
A) CONFIGURE PHABRICATOR
========================

./bin/config set policy.allow-public true
./bin/config set feed.public true
./bin/config set welcome.file rsrc/custom/static/welcome.html
./bin/config set welcome.file rsrc/custom/static/report_guidelines.html

set maniphest.custom-field-definitions

{
    "blender:task-type": {
        "name": "Type",
        "type": "select",
        "search": true,
        "options": {
            "Bug": "Bug",
            "Patch": "Patch",
            "Design": "Design",
            "To Do": "To Do",
            "Feature Request": "Feature Request",
            "OpenGL Error": "OpenGL Error"
        }
    }
}

set maniphest.priorities

{
  "100" : {
    "name"  : "Unbreak Now!",
    "short" : "Unbreak!",
    "color" : "indigo"
  },
  "90"  : {
    "name"  : "Needs Triage",
    "short" : "Triage",
    "color" : "violet"
  },
  "50"  : {
    "name"  : "Confirmed",
    "short" : "Confirmed",
    "color" : "orange"
  },
  "40"  : {
    "name"  : "Normal",
    "short" : "Normal",
    "color" : "yellow"
  },
  "30"  : {
    "name"  : "Incomplete",
    "short" : "Incomplete",
    "color" : "red"
  },
  "20"  : {
    "name"  : "Low",
    "short" : "Low",
    "color" : "yellow"
  }
}


Disable irrelevant applications


B) FILE STORAGE
===============

./bin/config set storage.local-disk.path /data/www/vhosts/developer.blender.org/htdocs/uploads

This is apparently not enough, still have 3GB of data in file_storageblob table?


C) MYSQL TABLE TWEAKS
=====================

Avoid F1, F2 shortcut keys being considered as file links:

ALTER TABLE phabricator_file.file AUTO_INCREMENT = 1000;

Avoid conflicts with existing report numbers or users while testing:

ALTER TABLE phabricator_maniphest.maniphest_task AUTO_INCREMENT = 50000;
ALTER TABLE phabricator_user.user AUTO_INCREMENT = 50000;


D) ACCIDENTAL EMAIL SENDING
===========================

All email addresses have been modified to avoid sending emails while users and tasks are being created.

However to avoid the DB filling up and postfix trying to send up loads of mails to invalid addresses, apply this patch to disable all feed logging and mails before import:

disable_feed_mail.patch


E) IMPORT USERS AND PROJECTS
============================

./export_users.php on projects.blender.org
copy over dump/ folder
./import_users.php on developer.blender.org

./import_projects.php


Set maniphest policies:

* Public view default
* Default edit policies: Moderators
* Everyting else: all users (for import)


F) IMPORT TASKS
===============

This is going to be slow and lots of data, best to do it in steps, perhaps starting with the newest reports.

./export_task.php 37000 38000
copy over dump/ folder
sudo -u www ./import_task.php 37000 38000

And so on for all task ranges ..


G) TESTS
========

* Check if number of developers with commit rights match
* Check if number of open bugs and patches roughly match
* Check for report status, attached files, missing comments, etc
* Unpatch disable_feed_mail.patch
* Add email address to you user settings to test (it's set to an invalid one for testing)
* Test if emails, password reset, etc works


H) FOR FINAL
============

* Search and remove _tmpdisabledemail_ on all email addresses in DB
* Preserve user and project data from testing period somehow, or dump it all?
* Replace projects.blender.org link in comments (either in DB or beforehand)
* Perhaps clear feeds in DB, may take up unnecessary space?
* Make redirects from projects.blender.org
* Set some file storage upload limit (e.g. ./bin/config set storage.upload-size-limit 10M)
* Modify permissions


